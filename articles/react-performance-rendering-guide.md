---
title: "å„ªå…ˆåº¦é †ï¼šReactã®å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æœ€é©åŒ–ã‚¬ã‚¤ãƒ‰"
emoji: "ğŸš¤"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ['React', 'å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°', 'ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹']
published: false
---

ã“ã®è¨˜äº‹ã§ã¯ã€Reactã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’å®Ÿè£…ã™ã‚‹ã«ã‚ãŸã‚Šã€ä½™è¨ˆãªå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’æŠ‘åˆ¶ã™ã‚‹ã“ã¨ã§ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’å‘ä¸Šã•ã›ã‚‹ãŸã‚ã®æ–½ç­–ã‚’**å®Ÿè£…ã®å„ªå…ˆåº¦é †**ã«ç´¹ä»‹ã—ã¾ã™ã€‚

:::message
å„ªå…ˆé †ä½ã¯ã‚³ã‚¹ãƒˆã¨å½±éŸ¿ã‚’å…ƒã«ä¸»è¦³ã§è¨­å®šã—ã¦ã„ã¾ã™ã€‚
:::

## ã¯ã˜ã‚ã«å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®ãƒ«ãƒ¼ãƒ«ã«ã¤ã„ã¦
ã¾ãšã¯ã˜ã‚ã«ã€Reactã®å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®ãƒ«ãƒ¼ãƒ«ã«ã¤ã„ã¦ç°¡å˜ã«ãŠã•ã‚‰ã„ã€‚
Reactã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã‚‹ãŸã‚ã«ã¯

1. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®`props`ãŒå¤‰æ›´ã•ã‚ŒãŸ
2. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®`state`ãŒå¤‰æ›´ã•ã‚ŒãŸ
3. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚ŒãŸ

ã®ã„ãšã‚Œã‹ã®æ¡ä»¶ã‚’æº€ãŸã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ãã‚Œã§ã¯æ—©é€ŸæŠ‘åˆ¶ã™ã‚‹æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¦ã„ãã¾ã™ï¼

## 1. ãªã‚‹ã¹ãstateã‚’ä½¿ã‚ãªã„
stateã¯å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’å¼•ãèµ·ã“ã—ãŸã„å ´é¢ã«é™å®šã—ã¦ä½¿ã„ã¾ã—ã‚‡ã†ã€‚
å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãŒä¸è¦ãªã‚±ãƒ¼ã‚¹ã§ã¯`useRef`ã‚’ä½¿ã£ã¦çŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹ã“ã¨ã§å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’æŠ‘åˆ¶ã§ãã¾ã™ã€‚

```tsx
import React, { useRef } from 'react';

const Component = () => {
  const hasClicked = useRef(false);
  
  const handleClick = () => {
    if (hasClicked.current) return;
    alert('Alert');
    hasClicked.current = true;
  }

  return (
      <button onClick={handleClick}>1å›ç›®ã ã‘Alert</button>
  );
};
```

ã¾ãŸã€ç®—å‡ºå‡ºæ¥ã‚‹å€¤ã¯stateã‚’ä½¿ã‚ãšã«ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ™‚ã«è¨ˆç®—ã™ã‚‹ã“ã¨ã‚‚æœ‰åŠ¹ã§ã™ã€‚
`useMemo`ã‚’ä½¿ã£ã¦ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã™ã‚‹æ–¹æ³•ã¨ä½µã›ã¦æ¤œè¨ã—ã¾ã—ã‚‡ã†ã€‚

## 2. stateã‚’æŒã¤ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å°ã•ãã™ã‚‹
stateã‚’æŒã¤ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®å¯¾è±¡ã¨ãªã‚‹ã®ã§ã€stateã‚’æŒã¤ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å°ã•ãã™ã‚‹ã“ã¨ã§å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®ç¯„å›²ã‚’æŠ‘åˆ¶ã§ãã¾ã™ã€‚
ãªã‚‹ã¹ãæœ«ç«¯ã®å­ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«stateã‚’æŒãŸã›ã‚‹ã‚ˆã†ã«ã™ã‚‹ã‹ã€éƒ¨åˆ†çš„ã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’åˆ†å‰²ã™ã‚‹ã®ã‚‚åŠ¹æœçš„ã§ã™ã€‚
stateã®ã‚¹ã‚³ãƒ¼ãƒ—ãŒç‹­ããªã‚Šã€å‡é›†åº¦ãŒé«˜ã¾ã‚‹ã‚±ãƒ¼ã‚¹ã‚‚å¤šã„ã§ã™ã€‚

```tsx
// before
const Component = () => {
  const [count, setCount] = useState(0);
  const handleClick = () => setCount(count + 1);

  return (
    <div>
      <button onClick={handleClick}>{count}</button>
      <HeavyComponent /> {/* ã‚¯ãƒªãƒƒã‚¯ã”ã¨ã«å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã¦ã—ã¾ã†... */}
    </div>
  );
};
```
```tsx
// after
// stateã‚’åˆ¥ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«åˆ†å‰²
const CountUpButton = () => {
  const [count, setCount] = useState(0);
  const handleClick = () => setCount(count + 1);

  return <button onClick={handleClick}>{count}</button>;
};

const Component = () => {
  return (
    <div>
      <CountUpButton />
      <HeavyComponent />
    </div>
  );
};
```

## 3. useMemo / useCallback
`useMemo`ãŠã‚ˆã³`useCallback`ã¯eslintã®ãŠé™°ã§depsæ¼ã‚Œã‚’æ¤œçŸ¥å‡ºæ¥ã‚‹ãŸã‚å®‰å…¨ã«å°å…¥ã—ã‚„ã™ãã¦ãŠã™ã™ã‚ã§ã™ã€‚

é–¢æ•°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã§å®šç¾©ã•ã‚Œã‚‹é–¢æ•°ã¯å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ™‚ã«å†ç”Ÿæˆã•ã‚Œã‚‹ãŸã‚ã€`useCallback`ã¯ç©æ¥µçš„ã«å°å…¥ã—ã¦ã„ã„ã§ã—ã‚‡ã†ã€‚

ãŸã ã—ã€`useMemo`ã«ã¤ã„ã¦ã¯å°å…¥ãŒé€†åŠ¹æœã«ãªã‚‹ã‚±ãƒ¼ã‚¹ã‚‚ã‚ã‚Šã¾ã™ã€‚
ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–å€¤ã§ã‚ã‚Œã°ãƒ¡ãƒ¢åŒ–ã™ã‚‹æ©æµãŒã‚ã¾ã‚Šãªã„ã®ã§ã€ç®—å‡ºå‡¦ç†ãŒè¤‡é›‘ãªå ´åˆã«é™å®šã—ã¦å°å…¥ã™ã‚‹ã¨è‰¯ã„ã§ã—ã‚‡ã†ã€‚

```tsx
const Component = () => {
  const [count, setCount] = useState(0);
  const handleClick = useCallback(() => setCount(count + 1), [count]);

  const bigNumber = useMemo(() => heavyCalc(count), [count]);
  
  return (
    <div>
      <button onClick={handleClick}>{count}</button>
      <p>{bigNumber}</p>
    </div>
  );
};
```

depsã«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå‹ãŒæŒ‡å®šã•ã‚Œã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã¯æ„å›³ã›ã¬å†ç”ŸæˆãŒç™ºç”Ÿã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚
ãã®å ´åˆã¯deepEqualãªã©ã‚’ä½¿ã£ã¦æ¯”è¼ƒã™ã‚‹ã“ã¨ã§å¯¾å‡¦ã§ãã¾ã™ã€‚

```tsx
import equal from 'fast-deep-equal';

const useDeepCompareMemoizeDeps = <T extends DependencyList[number]>(
  deps: T[]
) => {
  const ref = useRef<T[]>([]);
  if (
    deps.some((dependency, index) => !equal(dependency, ref.current[index]))
  ) {
    ref.current = deps;
  }
  return ref.current;
};

const Component = () => {
  const [user, setUser] = useState({name: 'John'});
  const handleClick = useCallback(() => setUser({name: 'Paul'}), []);

  const deepComparedDeps = useDeepCompareMemoizeDeps([user]);
  const heavyValue = useMemo(() => heavyCalc(user), deepComparedDeps);
  
  return (
    <div>
      <button onClick={handleClick}>{user.name}</button>
      <p>{heavyValue}</p>
    </div>
  );
};
```


## 4. childrenã‚’ä½¿ã£ã¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’åˆ†å‰²ã™ã‚‹
`props.children`ã®ç¯„å›²ã¯ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®å¯¾è±¡å¤–ã«ãªã‚Šã¾ã™ã€‚
é–¢æ•°å‹ç­‰ã®childrenã‚’ä½¿ã†å ´åˆã¯åˆ¥ã§è€ƒæ…®ãŒå¿…è¦ã§ã™ãŒã€ã‚·ãƒ³ãƒ—ãƒ«ãª`ReactNode`å‹ã§ã‚ã‚Œã°childrenã«é€ƒãŒã™ã“ã¨ã§ç°¡å˜ã«å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’æŠ‘åˆ¶å‡ºæ¥ã¾ã™ã€‚

```tsx
const Component = ({children}) => {
  const [count, setCount] = useState(0);
  const handleClick = () => setCount(count + 1);

  return (
    <div>
      <button onClick={handleClick}>{count}</button>
      {children} 
    </div>
  );
};

const App = () => {
  return (
    <Component>
      {/* ComponentãŒå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã¦ã‚‚childrenã®HeavyComponentã¯å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œãªã„ */}
      <HeavyComponent /> 
    </Component>
  );
};
```


## 5. React.memo
æœ€å¾Œã«å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æŠ‘åˆ¶ã®ä»£è¡¨çš„APIã§ã‚ã‚‹`React.memo`ã§ã™ã€‚
`React.memo` ã‚’ä½¿ã†ã“ã¨ã§ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒã„ã¤å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã‚‹ã¹ããªã®ã‹ã‚’ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

`React.memo` ã«ã¯çœç•¥å¯èƒ½ãªç¬¬äºŒå¼•æ•°ãŒã‚ã‚Šã¾ã™ã€‚
ãã“ã§ã¯ã€props ã®æ–°æ—§å€¤ã‚’æ¯”è¼ƒã—ã¦ã€ã“ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã‚‹ã¹ãã‹ã©ã†ã‹ã‚’åˆ¤å®šã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…ã§ãã¾ã™ã€‚

:::message
ç¬¬2å¼•æ•°ãŒæœªæŒ‡å®šã®ã¨ãã¯è‡ªå‹•çš„ã« props ãŒç­‰ã—ã„ã‹ã©ã†ã‹ã‚’åˆ¤æ–­ã•ã‚Œã¾ã™ã€‚
ã“ã®ã¨ãã« props ã«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå‹ãŒä½¿ã‚ã‚Œã¦ã„ã‚‹ã¨ React ã¯**æµ…ã„æ¯”è¼ƒ**ã‚’ã™ã‚‹ã“ã¨ã«ãªã‚‹ã®ã§ã€props ãŒç­‰ã—ã„ã‹ã©ã†ã‹ãŒæ­£ç¢ºã«åˆ¤æ–­ã•ã‚Œãªããªã£ã¦ã—ã¾ã„ã¾ã™ã€‚
`React.memo`ã®å°å…¥ã¯æ…é‡ã«è¡Œã„ã¾ã—ã‚‡ã†ã€‚
:::

```tsx
const HeavyComponent = React.memo(({count}) => {
  return <p>{heavyCalc(count)}</p>;
});
```

ç¬¬2å¼•æ•°ã®æ¯”è¼ƒã‚’æ‹¡å¼µã™ã‚‹ã“ã¨ã§ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç­‰ä¾¡æ¯”è¼ƒã‚’ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚
ã“ã¡ã‚‰ã‚‚ã‚³ã‚¹ãƒˆãŒã‹ã‹ã‚‹ãŸã‚ã€å¿…è¦ãªå ´é¢ã§ã€å¿…è¦ãªpropsã«ã®ã¿å°å…¥ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚

```tsx
import equal from 'fast-deep-equal';

const HeavyComponent = React.memo((props) => {
  return <p>{heavyCalc(props)}</p>;
}, (prevProps, nextProps) => {
  return equal(prevProps, nextProps);
});
```

## æœ€å¾Œã«
ä»¥ä¸Šã€Reactã®å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’æœ€é©åŒ–ã™ã‚‹ãŸã‚ã®å„ªå…ˆåº¦é †ã‚¬ã‚¤ãƒ‰ã§ã—ãŸã€‚

ã“ã®ä¸­ã§ã‚‚ç‰¹ã«`React.memo`ã®å°å…¥ã¯ãƒªã‚¹ã‚¯ã‚„ãƒ‡ãƒ¡ãƒªãƒƒãƒˆã‚‚ã‚ã‚‹ã®ãŸã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®æ”¹å–„ãŒå¿…è¦ã«ãªã‚‹ã¾ã§ã¯æ§˜å­è¦‹ã‚’ã™ã‚‹ã®ãŒã‚ªã‚¹ã‚¹ãƒ¡ã§ã™ã€‚
ã¾ãŸã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’å®Ÿéš›ã«è¨ˆæ¸¬ã—ãªãŒã‚‰å°å…¥ã—ã¾ã—ã‚‡ã†ã€‚

ãã®ä»–ã®æ–¹æ³•ã¯ã‚³ã‚¹ãƒˆãŒä½ãã€å°†æ¥çš„ã«`React.memo`ã‚’å°å…¥ã™ã‚‹éš›ã®ã‚³ã‚¹ãƒˆã‚‚ä¸‹ã’ã‚‹ã“ã¨ãŒå‡ºæ¥ã‚‹ãŸã‚ã€æ—©ã„æ®µéšã‹ã‚‰å–ã‚Šå…¥ã‚Œã¦ã„ã£ã¦ã‚‚ã‚ˆã„ã‹ã¨æ€ã„ã¾ã™ã€‚

