---
title: "ReactNative開発環境構築記録（MacOS）"
emoji: "👻"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["ReactNative"]
published: false
---

ReactNativeの環境を構築したときの流れをつまづきポイントを含めて記録する。

基本的には[公式Doc](https://reactnative.dev/docs/environment-setup)に沿っていく。
開発マシンのOSを選択した上で、

- Android
- iOS

を選択すると各デバイス用の環境セットアップ方法が確認できる。

※nodeはインストールされている前提で

## プロジェクト作成
```
npx react-native init MyApp --template react-native-template-typescript
```

## iOSの開発環境を構築
### watchmanインストール
Facebook開発のファイルウォッチャー

```
brew install watchman
```

### Xcodeアプデ
ドキュメントで指定されている設定にはじめからなってたのでそのまま。

### CocoaPods
ここでまず躓いた。
```
sudo gem install cocoapods
```

[CocoaPods公式](https://cocoapods.org/)ではrubyを使ったインストールを推奨されていたのでこの方法でインストールしょうとしたがエラーが発生。

```
ERROR:  Error installing cocoapods:
    ERROR: Failed to build gem native extension.
```

Qiitaの記事に同様の内容が見つかったのでこの方と同様の方法で解決。

https://qiita.com/mix_dvd/items/aff8dfbe849a3d948715

※このときに`universal-darwin`のバージョン番号が変わっていたので要注意。
logを見ると中のテキストから必要なバージョン番号が見れる。

あとはエラーメッセージを参考に`./ios`内で`pod install`とかやったりした。

とりあえずiOSは難なくクリア。


## Android
対するAndroidはかなり苦戦。。

### Java Delvelopment Kit
```
brew install --cask adoptopenjdk/openjdk/adoptopenjdk8
```

### Android Studio
まずAndroid Studioをセットアップする。

ドキュメントに記載されているライブラリを指定バージョンでインストールしていく。


### zshrc
zshrcにANDROID関連のパスを通す。

```
export ANDROID_HOME=$HOME/Library/Android/sdk
export PATH=$PATH:$ANDROID_HOME/emulator
export PATH=$PATH:$ANDROID_HOME/tools
export PATH=$PATH:$ANDROID_HOME/tools/bin
export PATH=$PATH:$ANDROID_HOME/platform-tools
```

### バーチャルデバイスを作成
ここも躓いた。ちゃんと読んでなかっただけだが、iOSはコマンドを実行すればシミュレータが起動するのに対して、Androidは先にエミュレータを立ち上げておく必要がある。

>If you have recently installed Android Studio, you will likely need to create a new AVD. Select "Create Virtual Device...", then pick any Phone from the list and click "Next", then select the Q API Level 29 image.

>Click "Next" then "Finish" to create your AVD. At this point you should be able to click on the green triangle button next to your AVD to launch it, then proceed to the next step.


### エミュレータ起動後実行するも動かない
```
yarn android
```

を実行するもなかなか動かない。

```
info Starting the app...
error Failed to start the app.
Error: spawnSync adb ENOENT
    at Object.spawnSync (internal/child_process.js:1041:20)
```

最終的に、AndroidStudioで`/android`を開き、ターミナルで
```
npx react-native run-android
```

で動いた。。

この方法だと先にエミュレータを起動しておく必要もなさそう。
